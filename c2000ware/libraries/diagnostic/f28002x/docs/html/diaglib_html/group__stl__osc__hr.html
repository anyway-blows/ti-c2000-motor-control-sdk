<!-- This comment will put IE 6, 7 and 8 in quirks mode -->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>Oscillator HRPWM API Functions</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="$relpath/search.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<table width="100%">
<tr>
  <td bgcolor="black" width="1"><a href="http://www.ti.com"><img border="0" src="tilogo.gif" /></a></td>
  <td bgcolor="red"><img src="titagline.gif" /></td>
</tr>
</table>
<!-- Generated by Doxygen 1.8.4 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#nested-classes">Data Structures</a> &#124;
<a href="#define-members">Macros</a> &#124;
<a href="#typedef-members">Typedefs</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">Oscillator HRPWM API Functions</div>  </div>
</div><!--header-->
<div class="contents">
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Data Structures</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="struct_s_t_l___o_s_c___h_r___obj.html">STL_OSC_HR_Obj</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Defines the OSC HR test object.  <a href="struct_s_t_l___o_s_c___h_r___obj.html#details">More...</a><br/></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:ga10e34f64b63a0da515caf65bdef5930b"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__stl__osc__hr.html#ga10e34f64b63a0da515caf65bdef5930b">STL_OSC_HR_PASS</a>&#160;&#160;&#160;0U</td></tr>
<tr class="separator:ga10e34f64b63a0da515caf65bdef5930b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gaadc6133216d2b683de950f9dbf50db87"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__stl__osc__hr.html#gaadc6133216d2b683de950f9dbf50db87">STL_OSC_HR_FAIL</a>&#160;&#160;&#160;1U</td></tr>
<tr class="separator:gaadc6133216d2b683de950f9dbf50db87"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga954d0a34003ac58b641002c618f01b73"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__stl__osc__hr.html#ga954d0a34003ac58b641002c618f01b73">STL_OSC_HR_SFO_INCOMPLETE</a>&#160;&#160;&#160;0</td></tr>
<tr class="separator:ga954d0a34003ac58b641002c618f01b73"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga8300402feda0714a0c65d74e2d4816f2"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__stl__osc__hr.html#ga8300402feda0714a0c65d74e2d4816f2">STL_OSC_HR_SFO_COMPLETE</a>&#160;&#160;&#160;1</td></tr>
<tr class="separator:ga8300402feda0714a0c65d74e2d4816f2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga5f6539053a9533a5bedf74c24e63edc1"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__stl__osc__hr.html#ga5f6539053a9533a5bedf74c24e63edc1">STL_OSC_HR_SFO_ERROR</a>&#160;&#160;&#160;2</td></tr>
<tr class="separator:ga5f6539053a9533a5bedf74c24e63edc1"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="typedef-members"></a>
Typedefs</h2></td></tr>
<tr class="memitem:ga9dac08505b5dd45656b9f275a612030b"><td class="memItemLeft" align="right" valign="top">typedef <a class="el" href="struct_s_t_l___o_s_c___h_r___obj.html">STL_OSC_HR_Obj</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__stl__osc__hr.html#ga9dac08505b5dd45656b9f275a612030b">STL_OSC_HR_Handle</a></td></tr>
<tr class="memdesc:ga9dac08505b5dd45656b9f275a612030b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Defines the OSC HR test handle.  <a href="#ga9dac08505b5dd45656b9f275a612030b">More...</a><br/></td></tr>
<tr class="separator:ga9dac08505b5dd45656b9f275a612030b"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:gaffdad83975c7057d414b825b5a0082a9"><td class="memItemLeft" align="right" valign="top">uint16_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__stl__osc__hr.html#gaffdad83975c7057d414b825b5a0082a9">STL_OSC_HR_testSFO</a> (const <a class="el" href="group__stl__osc__hr.html#ga9dac08505b5dd45656b9f275a612030b">STL_OSC_HR_Handle</a> oscHRHandle)</td></tr>
<tr class="memdesc:gaffdad83975c7057d414b825b5a0082a9"><td class="mdescLeft">&#160;</td><td class="mdescRight">Tests the HRPWM SFO library's calibration process to ensure execution completion and verify value of MEP scale factor.  <a href="#gaffdad83975c7057d414b825b5a0082a9">More...</a><br/></td></tr>
<tr class="separator:gaffdad83975c7057d414b825b5a0082a9"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<p>The code for this module is contained in <code>source/stl_osc_hr.c</code>, with <code><a class="el" href="stl__osc__hr_8h.html">include/stl_osc_hr.h</a></code> containing the API declarations for use by applications.</p>
<h1>Error Injection</h1>
<p>Here are techniques to inject error:</p>
<p><b><a class="el" href="group__stl__osc__hr.html#gaffdad83975c7057d414b825b5a0082a9" title="Tests the HRPWM SFO library&#39;s calibration process to ensure execution completion and verify value of ...">STL_OSC_HR_testSFO()</a></b> </p>
<ul>
<li>Set mepMax and mepMin the same value so that the MEP scale factor calculated by SFO calibration will be out of range.</li>
<li>Disable HRPWM clock by clearing HRPWM bit in the PCLKCR0 register.</li>
<li>Set sfoDelay to 0 to cause timeout. </li>
</ul>
<h2 class="groupheader">Macro Definition Documentation</h2>
<a class="anchor" id="ga10e34f64b63a0da515caf65bdef5930b"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define STL_OSC_HR_PASS&#160;&#160;&#160;0U</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a class="anchor" id="gaadc6133216d2b683de950f9dbf50db87"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define STL_OSC_HR_FAIL&#160;&#160;&#160;1U</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a class="anchor" id="ga954d0a34003ac58b641002c618f01b73"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define STL_OSC_HR_SFO_INCOMPLETE&#160;&#160;&#160;0</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a class="anchor" id="ga8300402feda0714a0c65d74e2d4816f2"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define STL_OSC_HR_SFO_COMPLETE&#160;&#160;&#160;1</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a class="anchor" id="ga5f6539053a9533a5bedf74c24e63edc1"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define STL_OSC_HR_SFO_ERROR&#160;&#160;&#160;2</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<h2 class="groupheader">Typedef Documentation</h2>
<a class="anchor" id="ga9dac08505b5dd45656b9f275a612030b"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef <a class="el" href="struct_s_t_l___o_s_c___h_r___obj.html">STL_OSC_HR_Obj</a>* <a class="el" href="group__stl__osc__hr.html#ga9dac08505b5dd45656b9f275a612030b">STL_OSC_HR_Handle</a></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Defines the OSC HR test handle. </p>

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a class="anchor" id="gaffdad83975c7057d414b825b5a0082a9"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint16_t STL_OSC_HR_testSFO </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="group__stl__osc__hr.html#ga9dac08505b5dd45656b9f275a612030b">STL_OSC_HR_Handle</a>&#160;</td>
          <td class="paramname"><em>oscHRHandle</em>)</td><td></td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Tests the HRPWM SFO library's calibration process to ensure execution completion and verify value of MEP scale factor. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">oscHRHandle</td><td>is a pointer to the OSC HR object.</td></tr>
  </table>
  </dd>
</dl>
<p>This function runs calibration using the SFO Library Software to calculate an appropriate Micro Edge Positioner (MEP) scale factor for HRPWM-supported ePWM modules to verify this value.</p>
<p>The ePWM module used for the test is selected by <em>ePWMBase</em> member of the OSC HR test object. The valid range of inputs is from EPWM1_BASE to EPWMx_BASE where x is the value specified by PWM_CH - 1. PWM_CH is defined in the SFO library header file SFO_V8.h. The channel member can be configured to select between channels A and B. The <em>mepEdgeMode</em> value is configured for the PWM edges to be controlled by MEP. The values <em>mepMin</em> and <em>mepMax</em> define the minimum and maximum bounds of the expected MEP scale factor range. The expected MEP scale factor for EPWMCLK of 100 MHz, given a step size of 150 ps, is about 66 MEP steps. (1/EPWMCLK)/Step size = (1/100 MHz)/150 ps is about 66.</p>
<p>The <em>sfoDelay</em> value is the delay count required for the SFO() to finish calibration. The typical EPWM cycles required for SFO() to complete calibration if called repeatedly without interrupts is 130,000 EPWMCLK cycles. Please refer to <b>Appendix</b> <b>A:</b> <b>SFO</b> <b>Library</b> <b>Software</b> of the Technical Reference Manual HRPWM chapter and the device datasheet for more details. The repetition rate at which SFO() needs to be executed depends on the application. If there is not a sufficiently large interval between SFO() calls, the SFO() will return and not advance to the next stage. The execution will only advance to the next stage if the previous call's execution has completed and SFO() is called again. This interval can be experimentally calculated for a particular application.</p>
<dl class="section note"><dt>Note</dt><dd>The SFO library binary is provided in the C2000Ware calibration libraries. The source code however is not publicly released. It may be made available in some cases upon request through an FAE.</dd></dl>
<dl class="section return"><dt>Returns</dt><dd>If the MEP scale factor calculated by the calibration falls within the MEP min and max values, the function returns <b>STL_OSC_HR_PASS</b>. If the calibration fails to complete in the specified delay, if SFO() returns an error status, or if the calculated MEP scale factor is outside the range, this function returns <b>STL_OSC_HR_FAIL</b>. </dd></dl>

</div>
</div>
</div><!-- contents -->
<hr size="1" /><small>
Copyright  2021, Texas Instruments Incorporated</small>
</body>
</html>
